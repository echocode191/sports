<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="description" content="Kiminini Premier League - Live standings with direct editing" />
  <meta name="theme-color" content="#0b8a3e" />
  <title>Kiminini Premier League â€” Editable Standings</title>
  
  <!-- Font Awesome for icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  
  <style>
    :root{
      --green:#0b8a3e;
      --light:#e9fff0;
      --accent:#12b24a;
      --muted:#6b6b6b;
      --dark:#063d1f;
      --shadow: rgba(6,80,34,0.12);
      --orange:#e07a2f;
      --border: #d0e7d6;
      --edit: #4285f4;
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
      background: linear-gradient(135deg, #f0fcf4 0%, #ffffff 100%);
      color: var(--dark);
      line-height: 1.4;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      padding-bottom: 70px;
      min-height: 100vh;
    }
    
    header {
      background: linear-gradient(90deg, var(--green), #0f7b39);
      color: white;
      padding: 16px;
      text-align: center;
      box-shadow: 0 4px 12px rgba(11,138,62,0.15);
      position: sticky;
      top: 0;
      z-index: 20;
    }
    
    header h1 {
      font-size: 20px;
      font-weight: 800;
      margin-bottom: 4px;
    }
    
    header p {
      font-size: 14px;
      opacity: 0.9;
    }
    
    .container {
      max-width: 100%;
      padding: 0 12px;
      margin: 0 auto;
    }
    
    /* Table Styles - Ruled Design */
    .table-container {
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 16px rgba(0,0,0,0.08);
      overflow: hidden;
      margin: 16px 0;
      border: 1px solid var(--border);
    }
    
    .table-header {
      background-color: var(--green);
      color: white;
      padding: 12px 16px;
      font-weight: 600;
      font-size: 16px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .table-wrapper {
      overflow-x: auto;
    }
    
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 14px;
    }
    
    thead th {
      background-color: #f8f8f8;
      padding: 12px 8px;
      text-align: center;
      font-weight: 600;
      font-size: 13px;
      color: var(--dark);
      border-bottom: 2px solid var(--border);
      position: sticky;
      top: 0;
      z-index: 10;
    }
    
    tbody tr {
      border-bottom: 1px solid var(--border);
      transition: background-color 0.2s;
    }
    
    tbody tr:last-child {
      border-bottom: none;
    }
    
    tbody tr:hover {
      background-color: var(--light);
    }
    
    tbody td {
      padding: 12px 8px;
      text-align: center;
      border-right: 1px solid var(--border);
      position: relative;
    }
    
    tbody td:last-child {
      border-right: none;
    }
    
    .team-name {
      text-align: left !important;
      font-weight: 600;
      display: flex;
      align-items: center;
    }
    
    .team-position {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 24px;
      height: 24px;
      background-color: var(--green);
      color: white;
      border-radius: 50%;
      margin-right: 8px;
      font-size: 12px;
      font-weight: 700;
      flex-shrink: 0;
    }
    
    .top-3 .team-position {
      background: linear-gradient(135deg, #f0ad4e, #d9534f);
    }
    
    .editable {
      cursor: pointer;
      position: relative;
    }
    
    .editable::after {
      content: '\f303';
      font-family: 'Font Awesome 6 Free';
      font-weight: 900;
      position: absolute;
      right: 4px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 10px;
      color: var(--edit);
      opacity: 0;
      transition: opacity 0.2s;
    }
    
    .editable:hover::after {
      opacity: 0.7;
    }
    
    .editing {
      background-color: rgba(66, 133, 244, 0.1);
    }
    
    .edit-input {
      width: 100%;
      padding: 8px;
      border: 1px solid var(--edit);
      border-radius: 4px;
      font-size: 14px;
      text-align: center;
      font-weight: 600;
    }
    
    .edit-input.text-input {
      text-align: left;
    }
    
    /* Controls */
    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin: 16px 0;
      justify-content: space-between;
      align-items: center;
    }
    
    .btn {
      background: var(--green);
      color: white;
      border: none;
      padding: 10px 14px;
      border-radius: 6px;
      font-weight: 600;
      font-size: 14px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: all 0.2s;
      flex-shrink: 0;
    }
    
    .btn:hover {
      background: #0a7a36;
    }
    
    .btn.ghost {
      background: transparent;
      color: var(--green);
      border: 1px solid var(--green);
    }
    
    .btn.ghost:hover {
      background: rgba(11,138,62,0.05);
    }
    
    .btn.warn {
      background: var(--orange);
    }
    
    .btn.warn:hover {
      background: #d0681f;
    }
    
    .btn-icon {
      width: 36px;
      height: 36px;
      padding: 0;
      justify-content: center;
      border-radius: 50%;
    }
    
    .admin-controls {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
    }
    
    .admin-status {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 14px;
      color: var(--muted);
    }
    
    .status-indicator {
      display: inline-block;
      width: 8px;
      height: 8px;
      border-radius: 50%;
    }
    
    .status-indicator.locked {
      background-color: var(--muted);
    }
    
    .status-indicator.unlocked {
      background-color: #4caf50;
    }
    
    /* Fixtures Section */
    .fixtures-section {
      background: white;
      border-radius: 12px;
      padding: 16px;
      margin: 16px 0;
      box-shadow: 0 4px 16px rgba(0,0,0,0.08);
      border: 1px solid var(--border);
    }
    
    .section-title {
      font-size: 16px;
      font-weight: 700;
      color: var(--green);
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .add-fixture {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 12px;
      align-items: center;
    }
    
    .add-fixture input {
      flex: 1;
      padding: 8px;
      border-radius: 6px;
      border: 1px solid var(--border);
      font-size: 14px;
      min-width: 120px;
    }
    
    .fixture-list {
      list-style: none;
    }
    
    .fixture-item {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      padding: 12px;
      border-radius: 8px;
      border: 1px solid var(--border);
      margin-bottom: 8px;
      align-items: center;
    }
    
    .fixture-teams {
      font-weight: 600;
      flex: 2;
      min-width: 200px;
    }
    
    .fixture-score {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .fixture-score input {
      width: 50px;
      padding: 8px;
      border-radius: 4px;
      border: 1px solid var(--border);
      text-align: center;
      font-size: 14px;
    }
    
    .fixture-actions {
      display: flex;
      gap: 6px;
    }
    
    .fixture-status {
      font-size: 12px;
      padding: 4px 8px;
      border-radius: 4px;
      font-weight: 600;
    }
    
    .fixture-status.played {
      background: rgba(11,138,62,0.1);
      color: var(--green);
    }
    
    /* Admin Panel */
    .admin-panel {
      display: none;
      background: var(--light);
      border-radius: 8px;
      padding: 12px;
      margin-top: 12px;
      border: 1px solid var(--accent);
    }
    
    .admin-panel.active {
      display: block;
    }
    
    .admin-panel p {
      font-size: 13px;
      margin-bottom: 8px;
      color: var(--dark);
    }
    
    /* Footer */
    footer {
      text-align: center;
      padding: 16px;
      color: var(--muted);
      font-size: 13px;
    }
    
    /* Toast Notification */
    .toast {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: var(--dark);
      color: white;
      padding: 12px 20px;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      display: flex;
      align-items: center;
      gap: 8px;
      z-index: 1000;
      opacity: 0;
      transition: opacity 0.3s;
      max-width: 90%;
    }
    
    .toast.show {
      opacity: 1;
    }
    
    .toast.success {
      background: var(--green);
    }
    
    .toast.error {
      background: #e74c3c;
    }
    
    .toast.warning {
      background: var(--orange);
    }
    
    /* Edit Mode Indicator */
    .edit-mode-indicator {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: var(--edit);
      color: white;
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: 600;
      display: none;
      align-items: center;
      gap: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      z-index: 100;
    }
    
    .edit-mode-indicator.active {
      display: flex;
    }
    
    /* Data Persistence Notice */
    .persistence-notice {
      background: rgba(11,138,62,0.1);
      border-left: 4px solid var(--green);
      padding: 10px;
      margin: 16px 0;
      border-radius: 0 6px 6px 0;
      font-size: 14px;
      color: var(--dark);
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    /* Mobile First Responsive */
    @media (min-width: 768px) {
      .container {
        max-width: 768px;
      }
      
      header h1 {
        font-size: 24px;
      }
      
      table {
        font-size: 15px;
      }
      
      thead th {
        padding: 14px 10px;
      }
      
      tbody td {
        padding: 14px 10px;
      }
      
      .controls {
        justify-content: space-between;
      }
      
      .admin-controls {
        flex-wrap: nowrap;
      }
      
      .add-fixture {
        flex-wrap: nowrap;
      }
    }
    
    @media (min-width: 1024px) {
      .container {
        max-width: 1024px;
      }
      
      .table-container {
        margin: 20px 0;
      }
      
      .fixtures-section {
        margin: 20px 0;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1>Kiminini Premier League</h1>
    <p>Live Standings & Results</p>
  </header>
  
  <div class="container">
    <div class="persistence-notice">
      <i class="fas fa-info-circle" style="color: var(--green);"></i>
      <span>All changes are saved automatically and will persist when you revisit</span>
    </div>
    
    <div class="controls">
      <div class="admin-controls">
        <input type="password" id="admin-pass" placeholder="Admin password" style="padding: 10px; border-radius: 6px; border: 1px solid var(--border); font-size: 14px; flex: 1; min-width: 150px;">
        <button class="btn" id="btn-login">
          <i class="fas fa-lock"></i> Login
        </button>
        <button class="btn ghost" id="btn-reset">
          <i class="fas fa-redo"></i> Reset
        </button>
        <button class="btn ghost" id="btn-clear">
          <i class="fas fa-trash"></i> Clear
        </button>
      </div>
      
      <div class="admin-status">
        Admin: <span id="admin-status"><span class="status-indicator locked"></span> Locked</span>
      </div>
    </div>
    
    <div class="table-container" id="table-container">
      <div class="table-header">
        <span>League Standings</span>
        <button class="btn btn-icon" id="edit-toggle" title="Toggle Edit Mode">
          <i class="fas fa-edit"></i>
        </button>
      </div>
      <div class="table-wrapper">
        <table id="league-table">
          <thead>
            <tr>
              <th>#</th>
              <th>Club</th>
              <th>P</th>
              <th>W</th>
              <th>D</th>
              <th>L</th>
              <th>F</th>
              <th>A</th>
              <th>GD</th>
              <th>Pts</th>
            </tr>
          </thead>
          <tbody id="table-body">
            <!-- Table rows will be generated by JavaScript -->
          </tbody>
        </table>
      </div>
    </div>
    
    <div class="fixtures-section">
      <h2 class="section-title">
        <i class="fas fa-calendar-alt"></i> Match Fixtures
      </h2>
      
      <div class="add-fixture">
        <input type="text" id="team-a" placeholder="Team A name">
        <span style="font-weight: 600; color: var(--muted);">vs</span>
        <input type="text" id="team-b" placeholder="Team B name">
        <button class="btn" id="add-fixture-btn">
          <i class="fas fa-plus"></i> Add
        </button>
      </div>
      
      <ul class="fixture-list" id="fixture-list">
        <!-- Fixtures will be generated by JavaScript -->
      </ul>
      
      <div class="admin-panel" id="admin-panel">
        <p><i class="fas fa-info-circle"></i> Tap any cell to edit team stats</p>
        <p><i class="fas fa-info-circle"></i> Enter scores and mark matches as played to update standings</p>
        <p><i class="fas fa-info-circle"></i> All changes are saved automatically</p>
      </div>
    </div>
    
    <footer>
      <p>Tap cells to edit. Data saved automatically.</p>
    </footer>
  </div>
  
  <div class="toast" id="toast"></div>
  <div class="edit-mode-indicator" id="edit-indicator">
    <i class="fas fa-edit"></i> Edit Mode
  </div>
  
  <script>
    // Constants
    const STORAGE_KEY = 'kiminini_premier_league';
    const ADMIN_PASSWORD = '2030';
    
    // Initial data
    const INITIAL_TEAMS = [
      {name: "Kiminini Legends FC", played: 34, won: 29, drawn: 3, lost: 2, goalsFor: 101, goalsAgainst: 32, goalDifference: 69, points: 90},
      {name: "Hilario Allstars FC", played: 34, won: 27, drawn: 5, lost: 2, goalsFor: 98, goalsAgainst: 16, goalDifference: 82, points: 86},
      {name: "Kiminini Stars FC", played: 34, won: 24, drawn: 5, lost: 5, goalsFor: 88, goalsAgainst: 33, goalDifference: 55, points: 77},
      {name: "Small Tigers FC", played: 34, won: 22, drawn: 5, lost: 7, goalsFor: 80, goalsAgainst: 40, goalDifference: 40, points: 71},
      {name: "Samba FC", played: 34, won: 21, drawn: 4, lost: 9, goalsFor: 67, goalsAgainst: 29, goalDifference: 38, points: 67},
      {name: "Royal Bullets FC", played: 34, won: 18, drawn: 6, lost: 10, goalsFor: 89, goalsAgainst: 47, goalDifference: 42, points: 60},
      {name: "Namawanga FC", played: 34, won: 17, drawn: 8, lost: 9, goalsFor: 78, goalsAgainst: 49, goalDifference: 29, points: 59},
      {name: "Kiminini United FC", played: 34, won: 17, drawn: 7, lost: 10, goalsFor: 78, goalsAgainst: 41, goalDifference: 37, points: 58},
      {name: "Konoin Legends FC", played: 34, won: 16, drawn: 7, lost: 11, goalsFor: 67, goalsAgainst: 55, goalDifference: 12, points: 55},
      {name: "Intermiami FC", played: 34, won: 16, drawn: 7, lost: 11, goalsFor: 65, goalsAgainst: 55, goalDifference: 10, points: 55},
      {name: "Kiminini V. College", played: 34, won: 11, drawn: 7, lost: 16, goalsFor: 52, goalsAgainst: 70, goalDifference: -18, points: 40},
      {name: "Roadblock FC", played: 34, won: 10, drawn: 7, lost: 17, goalsFor: 66, goalsAgainst: 75, goalDifference: -9, points: 37},
      {name: "Sabata FC", played: 33, won: 9, drawn: 7, lost: 17, goalsFor: 41, goalsAgainst: 68, goalDifference: -27, points: 34},
      {name: "Bukwet FC", played: 34, won: 10, drawn: 4, lost: 20, goalsFor: 38, goalsAgainst: 70, goalDifference: -32, points: 34},
      {name: "Baraton Allstars FC", played: 34, won: 10, drawn: 4, lost: 20, goalsFor: 41, goalsAgainst: 85, goalDifference: -44, points: 34},
      {name: "14 Brothers FC", played: 34, won: 7, drawn: 5, lost: 22, goalsFor: 43, goalsAgainst: 85, goalDifference: -42, points: 26},
      {name: "Mitoto FC", played: 34, won: 6, drawn: 7, lost: 21, goalsFor: 40, goalsAgainst: 68, goalDifference: -28, points: 25},
      {name: "Wazoefu FC", played: 34, won: 6, drawn: 7, lost: 21, goalsFor: 43, goalsAgainst: 88, goalDifference: -45, points: 25},
      {name: "Kiminini Rangers FC", played: 34, won: 5, drawn: 5, lost: 24, goalsFor: 52, goalsAgainst: 107, goalDifference: -55, points: 20},
      {name: "Home United FC", played: 33, won: 1, drawn: 4, lost: 28, goalsFor: 22, goalsAgainst: 136, goalDifference: -114, points: 7}
    ];
    
    // State
    let teams = [];
    let fixtures = [];
    let isAdmin = false;
    let editMode = false;
    let currentEditCell = null;
    
    // DOM Elements
    const tableBody = document.getElementById('table-body');
    const teamAInput = document.getElementById('team-a');
    const teamBInput = document.getElementById('team-b');
    const fixtureList = document.getElementById('fixture-list');
    const adminPassInput = document.getElementById('admin-pass');
    const adminStatus = document.getElementById('admin-status');
    const adminPanel = document.getElementById('admin-panel');
    const toast = document.getElementById('toast');
    const editToggle = document.getElementById('edit-toggle');
    const editIndicator = document.getElementById('edit-indicator');
    
    // Initialize
    function init() {
      loadData();
      renderTable();
      renderFixtures();
      setupEventListeners();
    }
    
    // Load data from localStorage
    function loadData() {
      const savedData = localStorage.getItem(STORAGE_KEY);
      if (savedData) {
        try {
          const data = JSON.parse(savedData);
          teams = data.teams || [...INITIAL_TEAMS];
          fixtures = data.fixtures || [];
          showToast('Data loaded successfully', 'success');
        } catch (e) {
          console.error('Error loading data:', e);
          teams = [...INITIAL_TEAMS];
          fixtures = [];
          showToast('Using default data', 'warning');
        }
      } else {
        teams = [...INITIAL_TEAMS];
        fixtures = [];
        showToast('Using default data', 'warning');
      }
    }
    
    // Save data to localStorage
    function saveData() {
      try {
        localStorage.setItem(STORAGE_KEY, JSON.stringify({ teams, fixtures }));
        showToast('Data saved successfully', 'success');
      } catch (e) {
        console.error('Error saving data:', e);
        showToast('Failed to save data', 'error');
      }
    }
    
    // Render the league table
    function renderTable() {
      // Calculate derived values
      teams.forEach(team => {
        team.played = team.won + team.drawn + team.lost;
        team.goalDifference = team.goalsFor - team.goalsAgainst;
        team.points = (team.won * 3) + team.drawn;
      });
      
      // Sort by points, then goal difference, then goals for
      teams.sort((a, b) => {
        if (b.points !== a.points) return b.points - a.points;
        if (b.goalDifference !== a.goalDifference) return b.goalDifference - a.goalDifference;
        return b.goalsFor - a.goalsFor;
      });
      
      // Clear table
      tableBody.innerHTML = '';
      
      // Render rows
      teams.forEach((team, index) => {
        const row = document.createElement('tr');
        if (index < 3) row.classList.add('top-3');
        
        row.innerHTML = `
          <td>${index + 1}</td>
          <td class="team-name editable" data-field="name" data-index="${index}">
            <span class="team-position">${index + 1}</span>
            ${team.name}
          </td>
          <td class="editable" data-field="played" data-index="${index}">${team.played}</td>
          <td class="editable" data-field="won" data-index="${index}">${team.won}</td>
          <td class="editable" data-field="drawn" data-index="${index}">${team.drawn}</td>
          <td class="editable" data-field="lost" data-index="${index}">${team.lost}</td>
          <td class="editable" data-field="goalsFor" data-index="${index}">${team.goalsFor}</td>
          <td class="editable" data-field="goalsAgainst" data-index="${index}">${team.goalsAgainst}</td>
          <td>${team.goalDifference}</td>
          <td><strong>${team.points}</strong></td>
        `;
        
        tableBody.appendChild(row);
      });
    }
    
    // Render fixtures
    function renderFixtures() {
      fixtureList.innerHTML = '';
      
      if (fixtures.length === 0) {
        fixtureList.innerHTML = '<li class="muted">No fixtures added yet</li>';
        return;
      }
      
      fixtures.forEach((fixture, index) => {
        const li = document.createElement('li');
        li.className = 'fixture-item';
        
        li.innerHTML = `
          <div class="fixture-teams">${fixture.teamA} vs ${fixture.teamB}</div>
          <div class="fixture-score">
            <input type="number" min="0" class="score-a" value="${fixture.scoreA || ''}" placeholder="A" data-index="${index}">
            <span>-</span>
            <input type="number" min="0" class="score-b" value="${fixture.scoreB || ''}" placeholder="B" data-index="${index}">
          </div>
          <div class="fixture-status ${fixture.played ? 'played' : ''}">${fixture.played ? 'Played' : 'Upcoming'}</div>
          <div class="fixture-actions">
            <button class="btn small ${fixture.played ? 'ghost' : ''}" data-action="${fixture.played ? 'revoke' : 'play'}" data-index="${index}">
              ${fixture.played ? '<i class="fas fa-undo"></i>' : '<i class="fas fa-check"></i>'} ${fixture.played ? 'Revoke' : 'Play'}
            </button>
            <button class="btn ghost small" data-action="delete" data-index="${index}">
              <i class="fas fa-trash"></i>
            </button>
          </div>
        `;
        
        fixtureList.appendChild(li);
      });
    }
    
    // Setup event listeners
    function setupEventListeners() {
      // Admin login
      document.getElementById('btn-login').addEventListener('click', () => {
        const password = adminPassInput.value.trim();
        if (password === ADMIN_PASSWORD) {
          isAdmin = true;
          adminStatus.innerHTML = '<span class="status-indicator unlocked"></span> Unlocked';
          adminPanel.classList.add('active');
          showToast('Admin access granted', 'success');
          adminPassInput.value = '';
        } else {
          showToast('Incorrect password', 'error');
        }
      });
      
      // Reset data
      document.getElementById('btn-reset').addEventListener('click', () => {
        if (confirm('Reset all data to initial values?')) {
          teams = [...INITIAL_TEAMS];
          fixtures = [];
          saveData();
          renderTable();
          renderFixtures();
          showToast('Data reset to initial values', 'success');
        }
      });
      
      // Clear data
      document.getElementById('btn-clear').addEventListener('click', () => {
        if (confirm('Clear all data? This cannot be undone.')) {
          localStorage.removeItem(STORAGE_KEY);
          teams = [...INITIAL_TEAMS];
          fixtures = [];
          renderTable();
          renderFixtures();
          showToast('All data cleared', 'warning');
        }
      });
      
      // Toggle edit mode
      editToggle.addEventListener('click', () => {
        if (!isAdmin) {
          showToast('Admin access required', 'warning');
          return;
        }
        
        editMode = !editMode;
        if (editMode) {
          editIndicator.classList.add('active');
          showToast('Edit mode enabled', 'success');
        } else {
          editIndicator.classList.remove('active');
          // Cancel any ongoing edit
          if (currentEditCell) {
            finishEdit(false);
          }
          showToast('Edit mode disabled', 'success');
        }
      });
      
      // Add fixture
      document.getElementById('add-fixture-btn').addEventListener('click', () => {
        const teamA = teamAInput.value.trim();
        const teamB = teamBInput.value.trim();
        
        if (!teamA || !teamB) {
          showToast('Please enter both team names', 'warning');
          return;
        }
        
        if (teamA === teamB) {
          showToast('Teams must be different', 'warning');
          return;
        }
        
        fixtures.push({
          teamA,
          teamB,
          scoreA: null,
          scoreB: null,
          played: false
        });
        
        saveData();
        renderFixtures();
        showToast('Fixture added', 'success');
        
        // Reset inputs
        teamAInput.value = '';
        teamBInput.value = '';
      });
      
      // Table cell editing
      tableBody.addEventListener('click', (e) => {
        if (!editMode) return;
        
        const cell = e.target.closest('.editable');
        if (!cell) return;
        
        // If we're already editing a cell, finish that edit first
        if (currentEditCell && currentEditCell !== cell) {
          finishEdit(true);
        }
        
        startEdit(cell);
      });
      
      // Handle input events when editing
      document.addEventListener('input', (e) => {
        if (e.target.classList.contains('edit-input')) {
          // Auto-resize input for team names
          if (e.target.classList.contains('text-input')) {
            e.target.style.width = Math.max(150, e.target.value.length * 8) + 'px';
          }
        }
      });
      
      // Handle key events when editing
      document.addEventListener('keydown', (e) => {
        if (!currentEditCell) return;
        
        if (e.key === 'Enter') {
          finishEdit(true);
        } else if (e.key === 'Escape') {
          finishEdit(false);
        }
      });
      
      // Handle clicks outside to finish editing
      document.addEventListener('click', (e) => {
        if (currentEditCell && !currentEditCell.contains(e.target)) {
          finishEdit(true);
        }
      });
      
      // Fixture actions
      fixtureList.addEventListener('click', (e) => {
        if (!isAdmin) {
          showToast('Admin access required', 'warning');
          return;
        }
        
        const button = e.target.closest('button');
        if (!button) return;
        
        const action = button.dataset.action;
        const index = parseInt(button.dataset.index);
        const fixture = fixtures[index];
        
        if (action === 'play') {
          const scoreAInput = document.querySelector(`.score-a[data-index="${index}"]`);
          const scoreBInput = document.querySelector(`.score-b[data-index="${index}"]`);
          
          const scoreA = parseInt(scoreAInput.value);
          const scoreB = parseInt(scoreBInput.value);
          
          if (isNaN(scoreA) || isNaN(scoreB)) {
            showToast('Please enter valid scores', 'warning');
            return;
          }
          
          // Update fixture
          fixture.scoreA = scoreA;
          fixture.scoreB = scoreB;
          fixture.played = true;
          
          // Update team stats
          updateTeamStats(fixture.teamA, fixture.teamB, scoreA, scoreB);
          
          saveData();
          renderTable();
          renderFixtures();
          showToast('Match result recorded', 'success');
          
        } else if (action === 'revoke') {
          if (!confirm('Revoke this match result?')) return;
          
          // Revert team stats
          revertTeamStats(fixture.teamA, fixture.teamB, fixture.scoreA, fixture.scoreB);
          
          // Update fixture
          fixture.played = false;
          fixture.scoreA = null;
          fixture.scoreB = null;
          
          saveData();
          renderTable();
          renderFixtures();
          showToast('Match result revoked', 'success');
          
        } else if (action === 'delete') {
          if (!confirm('Delete this fixture?')) return;
          
          // If played, revert stats first
          if (fixture.played) {
            revertTeamStats(fixture.teamA, fixture.teamB, fixture.scoreA, fixture.scoreB);
          }
          
          fixtures.splice(index, 1);
          saveData();
          renderFixtures();
          showToast('Fixture deleted', 'success');
        }
      });
      
      // Score input changes
      fixtureList.addEventListener('input', (e) => {
        if (e.target.classList.contains('score-a') || e.target.classList.contains('score-b')) {
          const index = parseInt(e.target.dataset.index);
          const fixture = fixtures[index];
          
          if (e.target.classList.contains('score-a')) {
            fixture.scoreA = e.target.value ? parseInt(e.target.value) : null;
          } else {
            fixture.scoreB = e.target.value ? parseInt(e.target.value) : null;
          }
          
          saveData();
        }
      });
    }
    
    // Start editing a cell
    function startEdit(cell) {
      if (currentEditCell === cell) return;
      
      currentEditCell = cell;
      const field = cell.dataset.field;
      const index = parseInt(cell.dataset.index);
      const currentValue = teams[index][field];
      
      // Add editing class
      cell.classList.add('editing');
      
      // Create input element
      const input = document.createElement('input');
      input.type = field === 'name' ? 'text' : 'number';
      input.value = currentValue;
      input.className = 'edit-input';
      
      if (field === 'name') {
        input.classList.add('text-input');
        input.style.width = Math.max(150, currentValue.length * 8) + 'px';
      }
      
      // Replace cell content with input
      if (field === 'name') {
        // For team name, keep the position badge
        const positionBadge = cell.querySelector('.team-position');
        cell.innerHTML = '';
        cell.appendChild(positionBadge);
        cell.appendChild(input);
      } else {
        cell.innerHTML = '';
        cell.appendChild(input);
      }
      
      // Focus and select input
      input.focus();
      if (field !== 'name') {
        input.select();
      }
    }
    
    // Finish editing and save or cancel
    function finishEdit(save) {
      if (!currentEditCell) return;
      
      const cell = currentEditCell;
      const field = cell.dataset.field;
      const index = parseInt(cell.dataset.index);
      const input = cell.querySelector('.edit-input');
      
      // Remove editing class
      cell.classList.remove('editing');
      
      if (save) {
        // Get new value
        let newValue;
        if (field === 'name') {
          newValue = input.value.trim();
          if (!newValue) {
            showToast('Team name cannot be empty', 'warning');
            // Restore original value
            renderTable();
            currentEditCell = null;
            return;
          }
        } else {
          newValue = parseInt(input.value) || 0;
          if (newValue < 0) {
            showToast('Value cannot be negative', 'warning');
            // Restore original value
            renderTable();
            currentEditCell = null;
            return;
          }
        }
        
        // Update team data
        teams[index][field] = newValue;
        
        // Save data
        saveData();
        
        // Re-render table
        renderTable();
        
        showToast('Updated successfully', 'success');
      } else {
        // Cancel edit - re-render table to restore original value
        renderTable();
      }
      
      currentEditCell = null;
    }
    
    // Update team stats based on match result
    function updateTeamStats(teamAName, teamBName, scoreA, scoreB) {
      const teamA = teams.find(t => t.name === teamAName);
      const teamB = teams.find(t => t.name === teamBName);
      
      if (!teamA || !teamB) return;
      
      // Update games played
      teamA.played = (teamA.played || 0) + 1;
      teamB.played = (teamB.played || 0) + 1;
      
      // Update goals
      teamA.goalsFor = (teamA.goalsFor || 0) + scoreA;
      teamA.goalsAgainst = (teamA.goalsAgainst || 0) + scoreB;
      
      teamB.goalsFor = (teamB.goalsFor || 0) + scoreB;
      teamB.goalsAgainst = (teamB.goalsAgainst || 0) + scoreA;
      
      // Update wins/draws/losses
      if (scoreA > scoreB) {
        teamA.won = (teamA.won || 0) + 1;
        teamB.lost = (teamB.lost || 0) + 1;
      } else if (scoreA < scoreB) {
        teamB.won = (teamB.won || 0) + 1;
        teamA.lost = (teamA.lost || 0) + 1;
      } else {
        teamA.drawn = (teamA.drawn || 0) + 1;
        teamB.drawn = (teamB.drawn || 0) + 1;
      }
    }
    
    // Revert team stats when match result is revoked
    function revertTeamStats(teamAName, teamBName, scoreA, scoreB) {
      const teamA = teams.find(t => t.name === teamAName);
      const teamB = teams.find(t => t.name === teamBName);
      
      if (!teamA || !teamB) return;
      
      // Revert games played
      teamA.played = Math.max(0, (teamA.played || 0) - 1);
      teamB.played = Math.max(0, (teamB.played || 0) - 1);
      
      // Revert goals
      teamA.goalsFor = Math.max(0, (teamA.goalsFor || 0) - scoreA);
      teamA.goalsAgainst = Math.max(0, (teamA.goalsAgainst || 0) - scoreB);
      
      teamB.goalsFor = Math.max(0, (teamB.goalsFor || 0) - scoreB);
      teamB.goalsAgainst = Math.max(0, (teamB.goalsAgainst || 0) - scoreA);
      
      // Revert wins/draws/losses
      if (scoreA > scoreB) {
        teamA.won = Math.max(0, (teamA.won || 0) - 1);
        teamB.lost = Math.max(0, (teamB.lost || 0) - 1);
      } else if (scoreA < scoreB) {
        teamB.won = Math.max(0, (teamB.won || 0) - 1);
        teamA.lost = Math.max(0, (teamA.lost || 0) - 1);
      } else {
        teamA.drawn = Math.max(0, (teamA.drawn || 0) - 1);
        teamB.drawn = Math.max(0, (teamB.drawn || 0) - 1);
      }
    }
    
    // Show toast notification
    function showToast(message, type = 'success') {
      toast.textContent = message;
      toast.className = 'toast show';
      
      if (type === 'success') {
        toast.classList.add('success');
      } else if (type === 'error') {
        toast.classList.add('error');
      } else if (type === 'warning') {
        toast.classList.add('warning');
      }
      
      setTimeout(() => {
        toast.classList.remove('show');
      }, 3000);
    }
    
    // Initialize the app
    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
